---
title: "常用sql总结"
date: 2025-11-17 18:15:00 +0800
categories: [CS basics, SQL] # [Top_category, sub_category]
tags: [sql]      # TAG names should always be lowercase
# author:gaoshan
# add image: ![img-description](/assets/img/os.jpg)
---

```sql
SELECT
    mc.dt,
    COUNT(*) AS total_clicks,
    SUM(CASE WHEN cv.conversion_count > 0 THEN 1 ELSE 0 END) AS conversions,
    ROUND(SUM(CASE WHEN cv.conversion_count > 0 THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) AS conversion_rate_percent
FROM medpro_dsp_click mc
LEFT JOIN (
    -- 预先聚合转化数据，避免数据膨胀
    SELECT bid_id, COUNT(*) AS conversion_count
    FROM medpro_dsp_conversion
    WHERE conversion_type = '33'
    AND dt = '2025-11-14'  -- 如果cv表有分区也加上
    GROUP BY bid_id
) cv ON mc.bid_id = cv.bid_id
WHERE mc.click_time IS NOT NULL
AND mc.account_id in ('1089', '1023')
AND mc.dt = '2025-11-14'
GROUP BY mc.dt;
```